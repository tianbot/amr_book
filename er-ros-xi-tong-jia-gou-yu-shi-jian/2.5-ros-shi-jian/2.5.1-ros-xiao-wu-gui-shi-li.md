# 2.5.1 ROS小乌龟实例

#### ROS小乌龟实例

我们这里首先讲述第一个ROS实践（小乌龟实践），这个简单的实例不仅可以验证我们的ROS是否安装成功，另一方面也可以对ROS的工作机制有个更加直观的了解。

**roscore**

roscore命令的作用就是启动ROS Master，我们需要在所有节点之前首先启动roscore。如同其他需要服务器才得以运行的程序一样，roscore可以使其他各个节点有机的组织起来。

**节点Nodes**

节点就是可执行程序。如果我们在运行节点的时候忘记启动roscore，而去直接启动节点文件，那么ROS会提示我们无法连接服务器。

图 2‑15 启动turtlesim节点

在运行roscore之后，我们要再打开一个窗口（Ctrl+Alt+T），然后输入如下命令：

$ rosrun turtlesim turtlesim\_node

你将会得到一张这样的界面：大家注意小海龟是随机生成的，样式有多种，不必深究。

图 2‑16 Turtlesim运行窗口

rosrun是运行单一的可执行的文件，也可以理解为运行单一的节点。roslaunch是可以运行多个可执行文件的脚本文件。若使用roslaunch启动，将会自动检测roscore是否启动，否则会自动启动roscore。但是我们还是建议初学者在使用测试的时候在单独的终端内启动roscore，可以避免一些因错误操作产生的问题。

此外提示大家善用Tab键（补全键），如果输入的命令后缀单一，Tab键就会直接补齐，如果后缀较多时，双击Tab键就会提供一个可选择的列表，如果这有助于大家提升输入速度。如果大家跟着Wiki去操作可能会感觉不到Tab键的神奇之处，如果大家跟着一些非官方的教程去练习，手动输入指令的时候经常会输错字符，这时候用Tab键是很有好处的。Tab键补全之后将会自动罗列出有关ROS指令。

图 2‑17 Tab键补全之后显示的指令

小乌龟已经出现了，但是无论我们按什么键都不能够运动，那该怎么办呢？我们现在要启动另外一个节点，在ROS中有各种各样的功能包，我们怎样实现各种各样的功能调用各种各样的节点，这是需要大家在日后的学习中不断去探索的一件重要事情。

输入如下命令即可启动操作键盘：

$ rosrun turtlesim turtle\_teleop\_key

图 2‑18 启动teleop节点

接下来使用上下左右键就可移动我们小乌龟了，记住操作键盘的时候必须选中管理键盘节点的terminal（窗口必须是激活的状态），否则接收不到键盘的信号，小乌龟还是不会动。

我们来总结一下我们刚开始打开的三个终端，第一个终端运行roscore，也就是服务器；第二个终端是ROS中最简单的仿真环境；最后一个终端相当于键盘的驱动。

很多初学者会觉得这只不过是比坦克大战还简单的一个程序为什么运行起来这么复杂呢？这是因为灵活的架构才能够更容易的完成复杂的任务。你可以把roscore想像成一个游戏服务器，而每个节点都是参与游戏的玩家，那么这种灵活的机制可以让任意多个玩家参与其中，共同完成任务，类似于MMORPG（大型多人在线角色扮演游戏）的机制。

可以使用rostopic info指令来查看一下turtlesim的节点信息：

④

③

②

①

图 2‑19 Turtlesim节点详情

* 1处描述的是/turtlesim这个节点。
* 2处是/turtlesim向三个节点所发出的消息。
* 3处是/turtlrsim订阅的消息，这个消息是由命令速度的节点发来的。
* 4处是可供选择的服务。

**Topic**

利用rostopic list命令查看系统中的话题列表。其中最关键的话题就是/turtle1/cmd\_vel，由键盘控制turtle\_teleop\_key节点发送并由turtlesim节点接收。其中的消息是标准的Twist（速度旋量）类型，包括各个维度的线速度与角速度分量。除了使用键盘控制，还可以向该话题发送消息或者使用手柄控制等多种方式控制小海龟的运动。

图 2‑20 显示话题列表

**Services**

就是指该节点可供选择的其它操作服务，例如该实例中的清除小海龟（kill），添加小海龟（spawn）等服务。

#### 话题与节点交互

如果roscore，turtlesim与turtle\_teleop\_key都正常运行，我们可以利用rostopic info查看/turtle1/cmd\_vel这一话题的详细信息。

图 2‑21 /turtle/cmd\_vel话题详情

感兴趣的同学也可以使用rostopic echo命令去监视话题，如可以看到每次操作参数值的变化。

图 2‑22 监测/turtle/cmd\_vel话题

我们还可以利用rostopic pub指令控制小海龟。可以传入参数-r 10，则表示按照10赫兹速率去发布。按照下列指令运行，我们可以看到小海龟在转圈。

$ rostopic pub -r 10 /turtle1/cmd\_vel geometry\_msgs/Twist "linear:

x: 1.0

y: 0.0

z: 0.0

angular:

x: 0.0

y: 1.0

z: 1.0"

图 2‑23 使用rostopic pub命令控制小海龟

综合以上两种发布命令的方式，我们可以对ROS控制有个更深刻的了解。还有很多命令大家要多去Wiki里参考。不要仅仅把小海龟当做一个简单Demo，运行成功便觉得万事大吉，实际上turtlesim作为一个最简仿真环境非常适合我们了解ROS的机制，以及差速机器人的运动特性。
